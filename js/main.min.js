"use strict";const start=document.querySelector(".start"),capture=document.querySelector(".capture"),restart=document.querySelector(".restart"),video=document.querySelector(".video"),loading=document.querySelector(".loading"),instructions=document.querySelector(".instructions"),genderEl=document.querySelector("#gender"),genderProbEl=document.querySelector("#genderProbability"),ageEl=document.querySelector("#age"),expressionEl=document.querySelector("#expression"),expressionProbEl=document.querySelector("#expressionProbability");let startAnalysis=!1;function startVideo(){navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1}).then(e=>{video.srcObject=e}).catch(e=>console.error(e))}restart.addEventListener("click",()=>window.location.reload(!1)),Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri("./models"),faceapi.nets.faceLandmark68Net.loadFromUri("./models"),faceapi.nets.faceRecognitionNet.loadFromUri("./models"),faceapi.nets.faceExpressionNet.loadFromUri("./models"),faceapi.nets.ageGenderNet.loadFromUri("./models")]).then(startVideo),video.addEventListener("playing",()=>{loading.classList.remove("active");const e=[];async function t(e){const t=new FormData;t.append("system","FacialAI"),t.append("capturedImage",e,"FacialAIBlob");const o=await fetch("./upload/",{method:"POST",body:t}),i=await o.json();console.log(i)}start.addEventListener("click",t=>{startAnalysis=!0,o.classList.add("active"),instructions.classList.add("active"),e.length=0}),capture.addEventListener("click",e=>{startAnalysis=!1;const o=document.querySelector(".captureCanvas");o.width=video.videoWidth,o.height=video.videoHeight,o.getContext("2d").drawImage(video,0,0,video.videoWidth,video.videoHeight),o.toBlob(e=>t(e))});const o=faceapi.createCanvasFromMedia(video);o.classList.add("canvas"),video.parentNode.insertBefore(o,video.nextSibling);const i={width:+window.getComputedStyle(video).width.slice(0,-2),height:+window.getComputedStyle(video).height.slice(0,-2)};faceapi.matchDimensions(o,i),setInterval(async()=>{function t(t){e.unshift(t)>=31&&(e.length=30);const o=e.reduce((e,t)=>e+t)/e.length;return o}const a=await faceapi.detectAllFaces(video,new faceapi.TinyFaceDetectorOptions).withFaceLandmarks().withFaceExpressions().withAgeAndGender(),n=faceapi.resizeResults(a,i);if(o.getContext("2d").clearRect(0,0,o.width,o.height),startAnalysis&&n.length>0){const{gender:e,genderProbability:o,age:i,expressions:a}=n[0],r=t(i),s=Object.keys(a),d=s.sort((e,t)=>a[e]-a[t])[s.length-1];genderEl.innerText=e.toUpperCase(),genderProbEl.innerText=`${Math.round(100*o)}%`,ageEl.innerText=`${Math.round(r,1)} years old`,expressionEl.innerText=d.toUpperCase(),expressionProbEl.innerText=`${Math.round(100*a[d])}%`}},100)});
//# sourceMappingURL=main.min.js.map